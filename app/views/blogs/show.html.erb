<section class="w-full text-base-dark bg-slate-200 py-4">
  <div class="max-w-[1024px] mx-auto px-4">
    <div class="flex flex-col items-center bg-slate-50 rounded-md px-2 md:px-6">
      <h1 class="font-bold text-lg md:text-xl p-4 text-center">
        <%= @blog.title %>
      </h1>
      <% if @blog.blog_image.present? %>
        <%= image_tag url_for(@blog.blog_image), class: "rounded-md w-full max-h-[500px] object-cover" %>
      <% end %>
      <div class="flex flex-col md:flex-row justify-between w-full my-3 px-2">
        <div class="flex flex-col justify-between font-medium w-full md:w-1/2 m-1 p-1">
          <span>Author: <%= @blog.milk_admin.full_name || @blog.milk_admin.email %></span>
          <span>Created: <%= @blog.created_at.to_date.inspect %></span>
        </div>
        <div class="flex justify-start md:justify-end w-full md:w-1/2 font-medium m-1 p-1">
          <span class="bg-input-border rounded-full px-3 py-1 text-sm md:text-base md:px-5">
            Category: <%= @blog.blog_category.title %>
          </span>
        </div>
      </div>
      <div class="flex flex-col md:flex-row w-full gap-4 px-2">
        <% if @blog.toc.present? %>
          <div class="underline font-medium hidden md:block md:w-1/4 my-3 p-2 text-blue-800 bg-slate-100 rounded-md sticky top-24 self-start">
            <%= @blog.toc %>
          </div>
        <% end %>
        
        <div class="<%= @blog.toc.present? ? 'md:w-3/4' : 'w-full' %> my-3 p-2 prose max-w-none">
          <% if @blog.processed_body.present? %>
            <%= display_blog_body(@blog) %>
          <% else %>
            <%= @blog.content %>
          <% end %>
        </div>
      </div>
      <div class="flex justify-center gap-4 py-2 my-2">
        <%
          share_url = blog_url(@blog)
          encoded_url = CGI.escape(share_url)
          encoded_title = CGI.escape(@blog.title)
          encoded_subtitle = CGI.escape(@blog.subtitle || @blog.title)
        %>

        <!-- Facebook -->
        <a href="https://www.facebook.com/sharer/sharer.php?u=<%= encoded_url %>"
           target="_blank"
           rel="noopener noreferrer"
           class="hover:opacity-75 transition-opacity"
           aria-label="Share on Facebook">
          <svg class="w-6 h-6 text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M13.135 6H15V3h-1.865a4.147 4.147 0 0 0-4.142 4.142V9H7v3h2v9.938h3V12h2.021l.592-3H12V6.591A.6.6 0 0 1 12.592 6h.543Z" clip-rule="evenodd"/>
          </svg>
        </a>

        <!-- Twitter/X -->
        <a href="https://twitter.com/intent/tweet?url=<%= encoded_url %>&text=<%= encoded_title %>"
           target="_blank"
           rel="noopener noreferrer"
           class="hover:opacity-75 transition-opacity"
           aria-label="Share on Twitter/X">
          <svg class="w-6 h-6 text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
            <path d="M13.795 10.533 20.68 2h-3.073l-5.255 6.517L7.69 2H1l7.806 10.91L1.47 22h3.074l5.705-7.07L15.31 22H22l-8.205-11.467Zm-2.38 2.95L9.97 11.464 4.36 3.627h2.31l4.528 6.317 1.443 2.02 6.018 8.409h-2.31l-4.934-6.89Z"/>
          </svg>
        </a>

        <!-- LinkedIn -->
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=<%= encoded_url %>&title=<%= encoded_title %>&summary=<%= encoded_subtitle %>"
           target="_blank"
           rel="noopener noreferrer"
           class="hover:opacity-75 transition-opacity"
           aria-label="Share on LinkedIn">
          <svg class="w-6 h-6 text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M12.51 8.796v1.697a3.738 3.738 0 0 1 3.288-1.684c3.455 0 4.202 2.16 4.202 4.97V19.5h-3.2v-5.072c0-1.21-.244-2.766-2.128-2.766-1.827 0-2.139 1.317-2.139 2.676V19.5h-3.19V8.796h3.168ZM7.2 6.106a1.61 1.61 0 0 1-.988 1.483 1.595 1.595 0 0 1-1.743-.348A1.607 1.607 0 0 1 5.6 4.5a1.601 1.601 0 0 1 1.6 1.606Z" clip-rule="evenodd"/>
            <path d="M7.2 8.809H4V19.5h3.2V8.809Z"/>
          </svg>
        </a>

        <!-- Copy Link (for Substack and other platforms) -->
        <button type="button"
                onclick="navigator.clipboard.writeText('<%= share_url %>').then(() => { const btn = this; const originalHTML = btn.innerHTML; btn.innerHTML = '<svg class=\'w-6 h-6 text-green-600\' fill=\'none\' stroke=\'currentColor\' viewBox=\'0 0 24 24\'><path stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'2\' d=\'M5 13l4 4L19 7\'></path></svg>'; setTimeout(() => btn.innerHTML = originalHTML, 2000); })"
                class="hover:opacity-75 transition-opacity cursor-pointer"
                aria-label="Copy link to share on Substack or other platforms">
          <svg class="w-6 h-6 text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.213 9.787a3.391 3.391 0 0 0-4.795 0l-3.425 3.426a3.39 3.39 0 0 0 4.795 4.794l.321-.304m-.321-4.49a3.39 3.39 0 0 0 4.795 0l3.424-3.426a3.39 3.39 0 0 0-4.794-4.795l-1.028.961"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</section>